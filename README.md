# cellmesh
微服务架构游戏服务框架


# 目标

- 服务与服务的对话

    业务逻辑编写不再关注网络，进程。根据预先规划的进程互联拓扑图，找到最高效的通讯方式。

- 通用型可扩展网关

    协助处理客户端长连接心跳及下线通知。封包按规则路由到服务，广播优化等。

- 基于服务发现

    使用服务发现实现服务选择策略，例如：获得一台负载最低的战斗服务器地址；将玩家尽量集中到某台服务器。

- 消息订阅发布

    在订阅和发布者之间选择一条最短路径通信（最短=直连），否则使用hub服务进行中转


# 设计

## Node（节点）

一个Node对应一个进程。

一个Node可以拥有多个不重名的Service。

Node的名称由进程名和动态分配的id组成，例如：game1, game2。动态生成的id保证全局唯一。

## Service（服务）

一个Service为一个Go类型，Service拥有多个消息处理Handler，每个Handler对应一个Service类型的方法

Service通过专有协议生成，同时生成传输协议的stub（例如protobuf）


## Agent（网关）

网关由多种Service组成

网关维护连入的User连接，使用心跳+底层断开通知确认User断开

## Transport（传输）
传输维护节点间的长连接，收发解码消息以及找到指定服务所在的节点。

如果配置服务间的传输必须使用长连接时，在节点启动时会尝试连接，而且必须在连接准备好时才能进行正常逻辑收发。



# FAQ
- 位于同一个Node的A Service调用B Service如何处理?
   这种方式处理逻辑效率较低，底层会提示错误，比不予处理。


# TODO
- [x] 基于Consul的服务发现及Watch机制
- [x] 网关基本逻辑
- [ ] 网关会话绑定,广播优化
- [ ] 网关心跳处理
- [ ] 登录服务器，JWT验证
- [ ] 玩家数据读取（mysql）,goorm
- [ ] 游戏服务器，成长逻辑，花钱升级等级
- [ ] 社交服务器，聊天逻辑（redis)
- [ ] 机器人